<!DOCTYPE html>
<html>
<head>
  <title>里客云 - 聚合图床 - 图片上传工具 - 图片外链获取</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.5.1/jquery.js"></script>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.3.1/css/bootstrap.min.css">
  <script src="https://cdn.staticfile.org/popper.js/1.15.0/umd/popper.min.js"></script>
  <script src="https://cdn.staticfile.org/twitter-bootstrap/4.3.1/js/bootstrap.min.js"></script>
  <link rel="stylesheet" type="text/css" href="css/style.css">
  <link rel="icon" href="https://bit-images.bj.bcebos.com/bit-new/file/20200709/tjsz.png" type="image/x-icon" />
</head>
<body>

<div class="container">
  <h2>里客云聚合图床</h2>
  <div class="card">
    <!-- API选择 -->
    <div class="card-header">
      <button type="button" class="select_background btn btn-outline-secondary" id="sogou">搜狗百科</button>
      <button type="button" class="btn btn-outline-secondary" id="tcl">TCL客服</button>
      <button type="button" class="btn btn-outline-secondary" id="sohu">搜狐焦点</button>
    </div>

    <!-- 选择图片上传控件 -->
    <div class="card-body">
      <form id="form" enctype="multipart/form-data">
        <div id="select_file">
          <div class="imgselect_btn">
            本地上传
            <input type="file" id="imgselect" name="file"/>
          </div>
        </div>
      </form>
    </div> 
    
    <!-- 图片地址显示，上传结果 -->
    <div class="Result"></div>
  </div>

  <!-- 复制链接按钮 -->
  <div class="copy btn btn-secondary" id="copy" style="margin:20px auto 10px;">复制链接</div>

  <!-- 复制提示 -->
  <div class="copysuccess" style="position:fixed;top:0;left:0;right:0;margin:0 auto;display: none;">
    <strong>复制成功!</strong> 
  </div>
  
  <!-- 图片显示区域 -->
  <div class="imgdiv"></div>

</div>

<script type="text/javascript">

// 默认API
api = 'sogou.php';

// 对当前点击对象更换css
$(document).ready(function(e){
    $('.container .card .card-header button').click(function(){
        $(this).siblings().removeClass('select_background');
        $(this).addClass('select_background');
        // 点击后的API
        api = this.id+'.php';
    })
});

// 监听[input=file]是否已经选择文件
$("#imgselect").bind('input propertychange',function(e){
  imgupload();
})

// 图片上传
function imgupload(){
  var form = new FormData(document.getElementById("form"));
  $.ajax({
    url:api,
    type:"post",
    data:form,
    cache: false,
    processData: false,
    contentType: false,
    success:function(data){
        if(data.code == 200){
            $(".container .imgdiv").html("<img src='"+data.path+"'/>");
            $(".container .card .Result").html("<div class=\"card-footer\" id=\"image_url\">"+data.path+"</div>");
            $("#copy").css("display","block");
            $("#imgselect").val("");
        }else{
            $(".container .card .Result").html("<div class=\"card-footer\">"+data.msg+"</div>");
        }
    },
    error:function(data){
        $(".container .card .Result").html("<div class=\"card-footer\">上传失败，可能是可能是"+api+"服务器问题</div>");
    },
    beforeSend:function(data){
        $(".container .card .Result").html("<div class=\"card-footer\">正在上传中...</div>");
    }
  })
}

// 复制链接
function hide(){
  $(".container .copysuccess").css("display","none");
}
function copyArticle(event){
  const range = document.createRange();
  range.selectNode(document.getElementById('image_url'));
  const selection = window.getSelection();
  if(selection.rangeCount > 0) selection.removeAllRanges();
  selection.addRange(range);
  document.execCommand('copy');
  $(".container .copysuccess").css("display","block");
  setTimeout('hide()', 2000);
}
window.onload = function () {
   var obt = document.getElementById("copy");
   obt.addEventListener('click', copyArticle, false);
}
</script>
</body>
</html>